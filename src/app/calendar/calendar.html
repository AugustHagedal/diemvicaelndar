<main>
  @if (showPopup() && selectedDay()) {
    <app-popup 
      [day]="selectedDay()!.day"
      [text]="selectedDay()!.unlocked_content_text || ''"
      [imageUrl]="selectedDay()!.image_url || ''"
      [weekday]="selectedDay()!.weekday"
      (close)="closePopup()"
    />
  }

  @if (countdownMessage()) {
    <div class="countdown-overlay" (click)="countdownMessage.set('')">
      <div class="countdown-message" (click)="$event.stopPropagation()">{{ countdownMessage() }}</div>
    </div>
  }

  <app-header (toggleTest)="toggleTestMode()" (logout)="logout()" (reset)="resetAllDays()"></app-header>

  <div class="header-sub">
    <h1>{{ title() }}</h1>
    @if (username()) {
      <h2 class="greeting">GlÃ¦delig jul {{ username() }}! ğŸ…</h2>
    }
    <p>Tryk pÃ¥ en dag for at fÃ¥ en overraskelse!</p>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p class="loading-text">IndlÃ¦ser julekalender...</p>
    </div>
  }

  @if (!isLoading()) {
    <div class="calendar-grid">
      @for (day of days(); track day.day) {
        <div 
          class="calendar-day"
          [class.opened]="day.opened"
          [class.locked]="!day.isAvailable && !day.opened"
          (click)="openDay(day)"
        >
          <div class="day-number">{{ day.day }}</div>
          @if (!day.opened && !day.isAvailable) {
            <div class="door-icon locked-icon">ğŸ”’</div>
          }
          @if (!day.opened && day.isAvailable) {
            <div class="door-icon">ğŸ</div>
          }
          @if (day.opened) {
            @if (day.image_url) {
              <div class="calendar-image-frame">
                <img [src]="day.image_url" alt="Day {{ day.day }}" class="calendar-day-image" />
              </div>
            } @else {
              <div class="opened-icon">ğŸ”“</div>
            }
          }
          <div class="weekday-label">{{ day.weekday }}</div>
        </div>
      }
    </div>
  }
</main>